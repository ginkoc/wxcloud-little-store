<view class="container">
  <view class="header">
    <text class="title">è®¢å•ç®¡ç†</text>
  </view>
  
  <view class="search-section">
    <!-- æœç´¢æ ç¬¬ä¸€è¡Œï¼šæœç´¢ç±»å‹å’Œè¾“å…¥æ¡† -->
    <view class="search-row">
      <view class="search-type">
        <picker bindchange="onSearchTypeChange" value="{{0}}" range="{{searchTypes}}" range-key="name">
          <view class="picker">
            {{searchTypes[searchType === 'orderId' ? 0 : (searchType === 'contactName' ? 1 : (searchType === 'contactPhone' ? 2 : 3))].name}}
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>
      <view class="search-input-container">
        <input class="search-input" placeholder="è¯·è¾“å…¥æœç´¢å†…å®¹" value="{{searchQuery}}" bindinput="onSearchInput" confirm-type="search" bindconfirm="doSearch" />
        <view class="search-btn" bindtap="doSearch">
          <text class="iconfont icon-search">ğŸ”</text>
        </view>
      </view>
      <!-- æ¸…ç©ºæŒ‰é’®ç§»åˆ°æœç´¢æŒ‰é’®æ—è¾¹ -->
      <view class="clear-btn" bindtap="clearSearch">æ¸…ç©º</view>
    </view>
    
    <!-- æœç´¢æ ç¬¬äºŒè¡Œï¼šè¿‡æ»¤é€‰é¡¹ -->
    <view class="filter-row">
      <!-- æ—¥æœŸç­›é€‰ - å»¶ä¼¸å®½åº¦ -->
      <view class="date-filter" bindtap="showDatePicker">
        <view class="filter-value">
          <text class="filter-label">æ—¥æœŸç­›é€‰</text>
          <view class="filter-text">{{dateRange.start ? (dateRange.start + ' è‡³ ' + (dateRange.end || 'ç°åœ¨')) : 'ä¸é™'}} <text class="arrow">â–¼</text></view>
        </view>
      </view>
      
      <!-- çŠ¶æ€ç­›é€‰ - å‹ç¼©å®½åº¦ -->
      <view class="status-filter">
        <picker bindchange="onStatusFilterChange" value="{{statusFilterIndex}}" range="{{statusList}}" range-key="text">
          <view class="filter-value">
            <text class="filter-label">çŠ¶æ€ç­›é€‰</text>
            <view class="filter-text">{{statusList[statusFilterIndex] ? statusList[statusFilterIndex].text : 'å…¨éƒ¨çŠ¶æ€'}} <text class="arrow">â–¼</text></view>
          </view>
        </picker>
      </view>
    </view>
  </view>
  
  <view class="date-picker-container" wx:if="{{showDatePicker}}">
    <view class="date-picker-mask" bindtap="onDatePickerCancel"></view>
    <view class="date-picker">
      <view class="date-picker-header">
        <text class="date-picker-title">é€‰æ‹©æ—¥æœŸèŒƒå›´</text>
        <text class="close-btn" bindtap="onDatePickerCancel">Ã—</text>
      </view>
      
      <view class="date-input-row">
        <text class="date-input-row-text">å¼€å§‹æ—¥æœŸï¼š</text>
        <picker mode="date" bindchange="onStartDateChange" value="{{dateRange.start}}">
          <view class="date-input">{{dateRange.start || 'é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
      </view>
      
      <view class="date-input-row">
        <text class="date-input-row-text">ç»“æŸæ—¥æœŸï¼š</text>
        <picker mode="date" bindchange="onEndDateChange" value="{{dateRange.end}}">
          <view class="date-input">{{dateRange.end || 'é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
      </view>
      
      <view class="date-picker-actions">
        <button class="date-picker-actions-btn cancel-btn" bindtap="onDatePickerCancel">å–æ¶ˆ</button>
        <button class="date-picker-actions-btn confirm-btn" bindtap="onDatePickerConfirm">ç¡®å®š</button>
      </view>
    </view>
  </view>
  
  <view class="order-list">
    <view class="list-header">
      <text class="result-info">å…± {{total}} æ¡è®°å½•</text>
      <text class="page-info">{{currentPage}}/{{totalPages}}é¡µ</text>
    </view>
    
    <!-- è®¢å•åˆ—è¡¨ -->
    <block wx:for="{{displayOrders}}" wx:key="_id">
      <view class="order-item card" bindtap="navigateToOrderDetail" data-id="{{item._id}}">
        <!-- è®¢å•æ ‡é¢˜æ  -->
        <view class="order-header">
          <view class="order-id-section">
            <text class="order-id-label">è®¢å•å·</text>
            <text class="order-id-value">{{item._id}}</text>
          </view>
          
          <!-- çŠ¶æ€æ ‡ç­¾æ”¾åœ¨å³ä¾§ -->
          <view class="order-status" style="color: {{item.statusColor}}">{{item.statusText}}</view>
        </view>
        
        <!-- è®¢å•å†…å®¹åŒº -->
        <view class="order-content">
          <view class="order-info-row">
            <view class="order-info-item">
              <text class="info-label">ä¸‹å•æ—¶é—´</text>
              <text class="info-value">{{item.createTime}}</text>
            </view>
            
            <view class="order-info-item" wx:if="{{item.contactName}}">
              <text class="info-label">è”ç³»äºº</text>
              <text class="info-value highlight">{{item.contactName}}</text>
            </view>
            
            <view class="order-info-item" wx:if="{{item.contactPhone}}">
              <text class="info-label">ç”µè¯</text>
              <text class="info-value">{{item.contactPhone}}</text>
            </view>
          </view>
          
          <!-- å•†å“å›¾ç‰‡ç¼©ç•¥å›¾åŒºåŸŸ -->
          <view class="order-product-images" wx:if="{{item.items && item.items.length}}">
            <scroll-view scroll-x="true" class="product-images-scroll">
              <view class="product-images-container">
                <block wx:for="{{item.items}}" wx:for-item="product" wx:key="productId">
                  <image class="product-thumbnail" src="{{product.imageURL || '/images/default-product.png'}}" mode="aspectFill" lazy-load="true"></image>
                </block>
              </view>
            </scroll-view>
          </view>
          
          <!-- å•†å“ä¿¡æ¯å’Œä»·æ ¼åŒºåŸŸ -->
          <view class="order-product-info" wx:if="{{item.items && item.items.length}}">
            <view class="product-info-row">
              <text class="product-count">å…±{{item.items.length}}ä»¶å•†å“</text>
              <view class="order-price">Â¥{{item.formattedTotalPrice || '0.00'}}</view>
            </view>
          </view>
        </view>
        
        <!-- æ“ä½œåŒºåŸŸ -->
        <view class="order-actions">
          <!-- æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® - ç§»åˆ°å³ä¾§ -->
          <view class="detail-btn-small" catchtap="navigateToOrderDetail" data-id="{{item._id}}" bindtap="markActionButtonClick">
            <text>æŸ¥çœ‹è¯¦æƒ…</text>
          </view>
        </view>
      </view>
    </block>
    
    <view class="empty-tip" wx:if="{{displayOrders.length === 0 && !isLoading}}">
      <text class="empty-tip-text">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®¢å•</text>
    </view>
    
    <view class="loading-container" wx:if="{{isLoading}}">
      <view class="loading-indicator"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <view class="pagination" wx:if="{{total > 0}}">
      <view class="page-btn {{currentPage === 1 ? 'disabled' : ''}}" bindtap="changePage" data-type="first">é¦–é¡µ</view>
      <view class="page-btn {{currentPage === 1 ? 'disabled' : ''}}" bindtap="changePage" data-type="prev">ä¸Šä¸€é¡µ</view>
      <view class="page-current">{{currentPage}}/{{totalPages}}</view>
      <view class="page-btn {{currentPage === totalPages ? 'disabled' : ''}}" bindtap="changePage" data-type="next">ä¸‹ä¸€é¡µ</view>
      <view class="page-btn {{currentPage === totalPages ? 'disabled' : ''}}" bindtap="changePage" data-type="last">æœ«é¡µ</view>
    </view>
  </view>
</view> 